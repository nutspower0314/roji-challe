MVP ç”»é¢é·ç§»å›³ï¼ˆãƒ•ãƒ­ãƒ¼ï¼‰ å…¨ä½“ãƒ•ãƒ­ãƒ¼ï¼ˆ10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‰ [0] åˆå›å°å…¥(ä»»æ„) â†“ [1] ãƒ›ãƒ¼ãƒ  â†“ (è¨­å®šï¼šé›£æ˜“åº¦ / æ€è€ƒã‚¿ã‚¤ãƒ— / 10å•é–‹å§‹) [2] å‡ºé¡Œãƒ»è§£ç­”ï¼ˆQ1ï¼‰ â†“ (åˆ¤å®šã™ã‚‹) [3] åˆ¤å®šãƒ»è§£èª¬ï¼ˆQ1ï¼‰ â†“ (æ¬¡ã¸) [2] å‡ºé¡Œãƒ»è§£ç­”ï¼ˆQ2ï¼‰ â†“ [3] åˆ¤å®šãƒ»è§£èª¬ï¼ˆQ2ï¼‰ â†“ ...ï¼ˆQ10ã¾ã§ç¹°ã‚Šè¿”ã—ï¼‰ â†“ [4] 10å•ãƒªã‚¶ãƒ«ãƒˆï¼ˆè¨ºæ–­ï¼‰ â†“ â†“ (ã‚‚ã†ä¸€å›) (å±¥æ­´/æˆé•·) â†“ â†“ [1] ãƒ›ãƒ¼ãƒ  [5] å±¥æ­´ãƒ»æˆé•· â†“ [1] ãƒ›ãƒ¼ãƒ  ç”»é¢ã”ã¨ã®ã€Œé·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã€å®šç¾© [1] ãƒ›ãƒ¼ãƒ  START_SESSION â†’ [2] å‡ºé¡Œ(Q1) OPEN_HISTORY â†’ [5] å±¥æ­´ãƒ»æˆé•· OPEN_SETTINGS â†’ [A] è¨­å®šï¼ˆä»»æ„ï¼‰ ã“ã“ã§ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³æ¡ä»¶ã€ã‚’ç¢ºå®š ä¾‹ï¼šé›£æ˜“åº¦â˜… / æ€è€ƒã‚¿ã‚¤ãƒ—ï¼ˆãŠã™ã™ã‚ or æŒ‡å®šï¼‰ / å‡ºé¡Œæ•°10 [2] å‡ºé¡Œãƒ»è§£ç­” SUBMIT_ANSWER â†’ [3] åˆ¤å®šãƒ»è§£èª¬ BACK_TO_HOMEï¼ˆä¸­æ–­ï¼‰â†’ [1] ãƒ›ãƒ¼ãƒ ï¼ˆâ€»ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ¨å¥¨ï¼‰ OPEN_HINTï¼ˆä»»æ„ï¼‰â†’ åŒç”»é¢å†…ãƒ¢ãƒ¼ãƒ€ãƒ« ã“ã®ç”»é¢ã¯ã€Œæ€è€ƒãƒœãƒ¼ãƒ‰ï¼ˆãƒã‚§ãƒƒã‚¯ãƒ»ãƒ¡ãƒ¢ãƒ»ä»®èª¬ï¼‰ã€ã‚‚å«ã‚ã¦çŠ¶æ…‹ã‚’æŒã¤ [3] åˆ¤å®šãƒ»è§£èª¬ NEXT_QUESTION QãŒæ®‹ã£ã¦ã„ã‚‹ â†’ [2] å‡ºé¡Œãƒ»è§£ç­”ï¼ˆæ¬¡ã®Qï¼‰ Q10å®Œäº† â†’ [4] 10å•ãƒªã‚¶ãƒ«ãƒˆ RETRY_THIS_QUESTIONï¼ˆä»»æ„ï¼‰â†’ [2] å‡ºé¡Œãƒ»è§£ç­”ï¼ˆåŒQã‚’å†å›ç­”ï¼‰ â€»MVPã§ã¯ç„¡ãã¦ã‚‚OKï¼ˆå®Ÿè£…ã‚³ã‚¹ãƒˆãŒå°‘ã—å¢—ãˆã‚‹ï¼‰ [4] 10å•ãƒªã‚¶ãƒ«ãƒˆï¼ˆè¨ºæ–­ï¼‰ RESTART â†’ [1] ãƒ›ãƒ¼ãƒ ï¼ˆæ¡ä»¶ã¯å¼•ãç¶™ãå¯ï¼‰ OPEN_HISTORY â†’ [5] å±¥æ­´ãƒ»æˆé•· SHAREï¼ˆä»»æ„ï¼‰â†’ Web Share API / ç”»åƒåŒ–ã¯å°†æ¥ [5] å±¥æ­´ãƒ»æˆé•· VIEW_SESSION_DETAILï¼ˆä»»æ„ï¼‰â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ï¼ˆMVPã§ã¯çœç•¥å¯ï¼‰ BACK_HOME â†’ [1] ãƒ›ãƒ¼ãƒ  [A] è¨­å®šï¼ˆä»»æ„ï¼‰ SAVE_SETTINGS â†’ å…ƒã®ç”»é¢ã«æˆ»ã‚‹ï¼ˆé€šå¸¸ã¯[1]ãƒ›ãƒ¼ãƒ ï¼‰ RESET_DATA â†’ LocalStorageåˆæœŸåŒ– ã€Œä¸­æ–­ãƒ»æˆ»ã‚‹ã€ã®åŸºæœ¬æ–¹é‡ï¼ˆMVPã§äº‹æ•…ã‚Šã‚„ã™ã„æ‰€ï¼‰ å‡ºé¡Œä¸­ã«ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹æ™‚ã¯ç¢ºèªï¼š ã€Œé€²è¡Œä¸­ã®10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’ä¸­æ–­ã—ã¾ã™ã‹ï¼Ÿã€ ãƒ–ãƒ©ã‚¦ã‚¶æˆ»ã‚‹å¯¾å¿œï¼š å¯èƒ½ãªã‚‰ beforeunload ã§ã‚¬ãƒ¼ãƒ‰ï¼ˆPWAã§ã‚‚åŠ¹ãç¯„å›²ã§ï¼‰ çŠ¶æ…‹ç®¡ç†ï¼ˆã“ã®é·ç§»ã‚’æ”¯ãˆã‚‹æœ€å°ãƒ¢ãƒ‡ãƒ«ï¼‰ å®Ÿè£…ãŒè¿·ã„ã«ãã„æœ€å°å˜ä½ã ã‘æ›¸ãã¨ï¼š appState settingsï¼šé›£æ˜“åº¦/ã‚¿ã‚¤ãƒ—/è¨€èª/æ–‡å­—ã‚µã‚¤ã‚º sessionï¼š sessionId questions[]ï¼ˆ10å•ã¶ã‚“ã®ç”Ÿæˆçµæœï¼‰ currentIndex answers[]ï¼ˆé¸æŠè‚¢/å…¥åŠ›/ä¸¦ã³æ›¿ãˆçµæœï¼‰ processLogs[]ï¼ˆæ€è€ƒãƒœãƒ¼ãƒ‰æ“ä½œãƒ­ã‚°ï¼šãƒã‚§ãƒƒã‚¯/ãƒ¡ãƒ¢/ä»®èª¬ï¼‰ metricsï¼ˆæ™‚é–“/ãƒ’ãƒ³ãƒˆå›æ•°ãªã©ï¼‰ history[]ï¼ˆéå»ã‚»ãƒƒã‚·ãƒ§ãƒ³è¦ç´„ï¼‰ MVPã®ã€Œæœ€çŸ­å®Ÿè£…ãƒ¢ãƒ¼ãƒ‰ã€ãƒ«ãƒ¼ãƒˆ ã‚‚ã—é€Ÿåº¦æœ€å„ªå…ˆãªã‚‰ã€æœ€åˆã¯ã“ã†å‰Šã£ã¦OKã§ã™ï¼š [0] åˆå›å°å…¥ï¼šç„¡ã— [5] å±¥æ­´ãƒ»æˆé•·ï¼šç„¡ã— [A] è¨­å®šï¼šç„¡ã— [3] è§£èª¬ï¼šåˆ¥ç”»é¢ã˜ã‚ƒãªã å‡ºé¡Œç”»é¢å†…ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ã‚‚OK ã¤ã¾ã‚Šï¼š ãƒ›ãƒ¼ãƒ  â†’ å‡ºé¡Œï¼ˆåˆ¤å®š/è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰Ã—10 â†’ ãƒªã‚¶ãƒ«ãƒˆ 1) ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆï¼ˆReact Routerï¼‰ MVPã¯ã“ã®5ãƒ«ãƒ¼ãƒˆã§ååˆ†ã§ã™ã€‚ / â€¦â€¦ Homeï¼ˆé–‹å§‹æ¡ä»¶è¨­å®šï¼‰ /play â€¦â€¦ å‡ºé¡Œãƒ»è§£ç­”ï¼ˆQè¡¨ç¤ºï¼‹æ€è€ƒãƒœãƒ¼ãƒ‰ï¼‰ /review â€¦â€¦ åˆ¤å®šãƒ»è§£èª¬ï¼ˆã‚‚ã—ãã¯ /play å†…ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ /result â€¦â€¦ 10å•ãƒªã‚¶ãƒ«ãƒˆï¼ˆè¨ºæ–­ï¼‰ /history â€¦â€¦ å±¥æ­´ãƒ»æˆé•·ï¼ˆMVPã§å…¥ã‚Œã‚‹ãªã‚‰ï¼‰ æœ€çŸ­å®Ÿè£…ãªã‚‰ /review ã¯ä½œã‚‰ãšã€/play å†…ãƒ¢ãƒ¼ãƒ€ãƒ«ã«çµ±åˆã—ã¦OKã€‚ 2) ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²ï¼ˆç”»é¢ï¼Pageã€æ©Ÿèƒ½ï¼Componentï¼‰ Pagesï¼ˆãƒ«ãƒ¼ãƒˆç›´ä¸‹ï¼‰ HomePage PlayPage ResultPage HistoryPageï¼ˆä»»æ„ï¼‰ Componentsï¼ˆå†åˆ©ç”¨éƒ¨å“ï¼‰ HomePage é…ä¸‹ DifficultyPicker ThinkTypePicker StartButton MiniProgressCardï¼ˆå‰å›çµæœè¡¨ç¤ºï¼šä»»æ„ï¼‰ PlayPage é…ä¸‹ï¼ˆæœ€é‡è¦ï¼‰ QuestionHeaderï¼ˆQç•ªå·/æ®‹ã‚Š/ã‚¿ã‚¤ãƒãƒ¼ï¼‰ ProblemStatement AnswerAreaï¼ˆå•é¡Œã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦åˆ‡æ›¿ï¼‰ AnswerAreaElimination AnswerAreaOrdering AnswerAreaCondition AnswerAreaHypothesis ThinkingBoardï¼ˆå·®åˆ¥åŒ–ã®æ ¸ï¼‰ ConditionChecklist HypothesisChips MemoPad SubmitBarï¼ˆåˆ¤å®šã™ã‚‹/ãƒ’ãƒ³ãƒˆ/ä¸­æ–­ï¼‰ ReviewModalï¼ˆåˆ¤å®šãƒ»è§£èª¬ï¼šæœ€çŸ­ãªã‚‰ã“ã“ã«çµ±åˆï¼‰ ResultBadgeï¼ˆæ­£èª¤ï¼‰ WhyThisIsWrongï¼ˆèª¤ç­”ç†ç”±åˆ†å²ï¼‰ ProcessVisualizationï¼ˆã©ã“ã§ã‚ºãƒ¬ãŸã‹ï¼‰ NextButton ResultPage é…ä¸‹ ScoreSummary TypeBreakdownï¼ˆæ€è€ƒã‚¿ã‚¤ãƒ—åˆ¥ï¼‰ WeaknessInsightsï¼ˆå‚¾å‘æ¨å®šï¼‰ NextRecommendations CTAButtonsï¼ˆã‚‚ã†ä¸€å›/å±¥æ­´ï¼‰ HistoryPage é…ä¸‹ï¼ˆä»»æ„ï¼‰ HistoryList TrendChartï¼ˆç°¡æ˜“æ£’ã‚°ãƒ©ãƒ•ï¼‰ SessionCard 3) çŠ¶æ…‹ç®¡ç†ï¼ˆZustandæ¨å¥¨ï¼‰ ç†ç”±ï¼šãƒšãƒ¼ã‚¸è·¨ãã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒä¸­å¿ƒã§ã€Reduxã»ã©é‡ããªã„ã€‚ Storeæ§‹é€ ï¼ˆMVPç‰ˆï¼‰ settingsStore difficultyï¼ˆ1ã€œ3ï¼‰ thinkTypeï¼ˆrecommended / condition / elimination / ordering / hypothesisï¼‰ sessionStore statusï¼ˆidle / playing / reviewing / finishedï¼‰ sessionId questions[]ï¼ˆ10å•ã¶ã‚“ï¼‰ currentIndex currentDraftï¼ˆå…¥åŠ›é€”ä¸­ã®å›ç­”ãƒ»æ€è€ƒãƒœãƒ¼ãƒ‰ï¼‰ answers[]ï¼ˆç¢ºå®šå›ç­”ï¼‰ logs[]ï¼ˆæ€è€ƒãƒœãƒ¼ãƒ‰æ“ä½œãƒ­ã‚°ï¼šä»»æ„ï¼‰ metricsï¼ˆtime, hintCountï¼‰ historyStore history[]ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³è¦ç´„ï¼‰ saveSessionSummary()ï¼ˆLocalStorageã¸ï¼‰ æœ€åˆã‹ã‚‰3ã‚¹ãƒˆã‚¢ã«åˆ†ã‘ã‚‹ã®ãŒé¢å€’ãªã‚‰ã€MVPã¯ useAppStore 1ã¤ã§ã‚‚OKã€‚ 4) â€œãƒ­ã‚¸ãƒƒã‚¯å±¤â€ã‚’UIã‹ã‚‰åˆ†é›¢ã™ã‚‹ï¼ˆè¶…é‡è¦ï¼‰ ãƒ•ã‚©ãƒ«ãƒ€ã‚’åˆ‡ã£ã¦ãŠãã¨å¾Œã§çˆ†ç™ºã—ã¾ã›ã‚“ã€‚ domain/ problemTypes/ elimination.ts ordering.ts â€¦ generator.tsï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬Ã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å•é¡Œç”Ÿæˆï¼‰ validator.tsï¼ˆå›ç­”åˆ¤å®šï¼šæ­£èª¤ï¼‹èª¤ç­”ç†ç”±ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™ï¼‰ explain.tsï¼ˆç†ç”±ã‚³ãƒ¼ãƒ‰â†’è¡¨ç¤ºæ–‡ãƒ»å¯è¦–åŒ–ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ï¼‰ UIã¯ã€Œè¡¨ç¤ºã™ã‚‹ã ã‘ã€ã€åˆ¤å®šã¨èª¬æ˜ã¯ domain ã«å¯„ã›ã¾ã™ã€‚ 5) æœ€å°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆãã®ã¾ã¾ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®éª¨ã«ãªã‚‹ï¼‰ src/ app/ router.tsx layout/ AppLayout.tsx pages/ HomePage.tsx PlayPage.tsx ResultPage.tsx HistoryPage.tsx components/ home/ play/ result/ history/ common/ store/ settingsStore.ts sessionStore.ts historyStore.ts domain/ generator/ validator/ explain/ types.ts infra/ storage/ localStorage.ts styles/ main.tsx 6) ç”»é¢é·ç§»ã®å®Ÿè£…æ–¹é‡ï¼ˆäº‹æ•…é˜²æ­¢ï¼‰ HomePageã§ startSession() questions10å•ã‚’ç”Ÿæˆã—ã¦ sessionStore ã«ã‚»ãƒƒãƒˆ navigate("/play") PlayPageã§ submitAnswer() validator ã§åˆ¤å®š â†’ reviewData ã‚’ä½œã‚‹ ReviewModal ã‚’é–‹ãï¼ˆã¾ãŸã¯ /review ã«é·ç§»ï¼‰ NextæŠ¼ä¸‹ currentIndex++ 10å•å®Œäº†ãªã‚‰ finishSession() â†’ navigate("/result") æ¡ä»¶æ•´ç†å‹ å•é¡Œãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆMVPç”¨ãƒ»ç¢ºå®šæ¡ˆï¼‰ 1. æ¡ä»¶æ•´ç†å‹ã¨ã¯ï¼ˆå®šç¾©ã®å›ºå®šï¼‰ è¤‡æ•°ã®æ¡ä»¶æ–‡ã‚’æ•´ç†ãƒ»çµ±åˆã—ã€ æˆã‚Šç«‹ã¤ï¼æˆã‚Šç«‹ãŸãªã„çŠ¶æ…‹ã‚’è«–ç†çš„ã«åˆ¤å®šã™ã‚‹å•é¡Œ é‡è¦ï¼š è¨ˆç®—åŠ›ã¯ä¸è¦ æ­£è§£ã¯ã€Œè«–ç†çš„ã«å”¯ä¸€ã€ é–“é•ã„ã¯ æ¡ä»¶ã®è¦‹è½ã¨ã—ï¼èª¤è§£ï¼é †åºãƒŸã‚¹ ã«åˆ†é¡ã§ãã‚‹ 2. å•é¡Œã®åŸºæœ¬æ§‹é€ ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰ å•é¡Œä¸–ç•Œã®æœ€å°æ§‹æˆ å¯¾è±¡ï¼š3ã€œ5å€‹ï¼ˆäººãƒ»ç‰©ãƒ»æ›œæ—¥ãƒ»å ´æ‰€ãªã©ï¼‰ æ¡ä»¶ï¼š3ã€œ6å€‹ å•ã„ï¼š ã€Œæ­£ã—ã„çµ„ã¿åˆã‚ã›ã¯ã©ã‚Œã‹ã€ ã€Œæˆã‚Šç«‹ã¤ã‚‚ã®ã¯ã©ã‚Œã‹ã€ ğŸ‘‰ MVPã§ã¯ 3å¯¾è±¡ï¼‹3æ¡ä»¶ ãŒãƒ™ã‚¹ãƒˆï¼ˆè»½ã„ãƒ»å£Šã‚Œã«ãã„ï¼‰ 3. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆãã®ã¾ã¾ã‚³ãƒ¼ãƒ‰ã«ã§ãã‚‹å½¢ï¼‰ Problemå®šç¾© type ConditionProblem = { id: string; difficulty: 1 | 2 | 3; entities: string[]; // å¯¾è±¡ï¼ˆä¾‹: ["A", "B", "C"]ï¼‰ attributes: string[]; // å±æ€§ï¼ˆä¾‹: ["èµ¤", "é’", "ç·‘"]ï¼‰ conditions: Condition[]; question: string; choices: Choice[]; correctChoiceId: string; }; æ¡ä»¶å®šç¾© type Condition = | { type: "equals"; entity: string; attribute: string } | { type: "notEquals"; entity: string; attribute: string } | { type: "ifThen"; if: Condition; then: Condition }; é¸æŠè‚¢ type Choice = { id: string; mapping: Record<string, string>; // ä¾‹: { A: "èµ¤", B: "é’", C: "ç·‘" } }; 4. å…·ä½“ä¾‹ï¼ˆMVPç”¨ã‚µãƒ³ãƒ—ãƒ«å•é¡Œï¼‰ å•é¡Œæ–‡ Aãƒ»Bãƒ»C ã®3äººãŒã€ãã‚Œãã‚Œ èµ¤ãƒ»é’ãƒ»ç·‘ ã®ã„ãšã‚Œã‹ã®å¸½å­ã‚’ã‹ã¶ã£ã¦ã„ã¾ã™ã€‚ æ¬¡ã®æ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™çµ„ã¿åˆã‚ã›ã¯ã©ã‚Œã§ã—ã‚‡ã†ï¼Ÿ æ¡ä»¶ Aã¯èµ¤ã§ã¯ãªã„ é’ã‚’ã‹ã¶ã£ã¦ã„ã‚‹äººã¯Bã§ã¯ãªã„ ã‚‚ã—CãŒç·‘ãªã‚‰ã€Aã¯é’ã§ã‚ã‚‹ é¸æŠè‚¢ A: A=é’ / B=èµ¤ / C=ç·‘ âœ… B: A=ç·‘ / B=èµ¤ / C=é’ C: A=é’ / B=ç·‘ / C=èµ¤ D: A=èµ¤ / B=é’ / C=ç·‘ 5. åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¶…é‡è¦ï¼‰ validate ã®è²¬å‹™ æ­£èª¤ã ã‘ã§ãªã **ã€Œã©ã®æ¡ä»¶ã§ç ´ç¶»ã—ãŸã‹ã€**ã‚’è¿”ã™ type ValidationResult = { isCorrect: boolean; failedConditions?: number[]; // ç ´ã£ãŸæ¡ä»¶ã®index }; åˆ¤å®šã‚¤ãƒ¡ãƒ¼ã‚¸ function validate(choice, conditions): ValidationResult { const failed = []; conditions.forEach((cond, index) => { if (!checkCondition(cond, choice)) { failed.push(index); } }); return { isCorrect: failed.length === 0, failedConditions: failed, }; } 6. è§£èª¬ç”Ÿæˆï¼ˆèª¤ç­”ç†ç”±ã®åˆ†å²ï¼‰ èª¤ç­”ç†ç”±ã‚«ãƒ†ã‚´ãƒªï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬åŒ–ï¼‰ type MistakeReason = | "condition_miss" // æ¡ä»¶æœªé©ç”¨ | "condition_misread"// æ¡ä»¶èª¤è§£ | "logic_jump"; // ä»®å®šã®é£›èº failedConditions ã‹ã‚‰ç†ç”±ã‚’æ¨å®š 1ã¤ã ã‘ç ´ã£ã¦ã„ã‚‹ â†’ æ¡ä»¶æœªé©ç”¨ ifThenç³»ã‚’ç ´ã£ã¦ã„ã‚‹ â†’ ä»®å®šå‡¦ç†ãƒŸã‚¹ è¤‡æ•°ç ´ã£ã¦ã„ã‚‹ â†’ æ¡ä»¶æ•´ç†ä¸è¶³ ğŸ‘‰ æ–‡ç« ã¯å›ºå®šãƒ†ãƒ³ãƒ—ãƒ¬ï¼‹æ¡ä»¶åå·®ã—è¾¼ã¿ã§OK 7. æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹å¯è¦–åŒ–ï¼ˆUIé€£å‹•ï¼‰ ThinkingBoardï¼ˆæ¡ä»¶æ•´ç†å‹å°‚ç”¨ï¼‰ æ¡ä»¶ä¸€è¦§ï¼ˆãƒã‚§ãƒƒã‚¯å¯èƒ½ï¼‰ æ¡ä»¶1ï¼šAã¯èµ¤ã§ã¯ãªã„ æ¡ä»¶2ï¼šé’ã®äººã¯Bã§ã¯ãªã„ æ¡ä»¶3ï¼šã‚‚ã—CãŒç·‘ãªã‚‰â€¦ ãƒ­ã‚°ä¾‹ { checkedConditions: [0, 1], uncheckedConditions: [2] } â†’ è§£èª¬ã§ ã€Œæ¡ä»¶3ãŒæœªæ¤œè¨ã®ã¾ã¾çµè«–ã‚’å‡ºã—ã¦ã„ã¾ã™ã€ ãŒè¨€ãˆã‚‹ã€‚ 8. é›£æ˜“åº¦è¨­è¨ˆãƒ«ãƒ¼ãƒ«ï¼ˆæœ€åˆã‹ã‚‰æ±ºã‚ã‚‹ï¼‰ é›£æ˜“åº¦ ç‰¹å¾´ â˜…1 å¦å®šæ¡ä»¶ã®ã¿ï¼ˆequals / notEqualsï¼‰ â˜…2 ifThen ãŒ1ã¤å…¥ã‚‹ â˜…3 ifThen è¤‡æ•° or æ¡ä»¶ãŒ5ã¤ ğŸ‘‰ å•é¡Œæ–‡ã®é›£ã—ã•ã§ã¯ãªãã€è«–ç†æ§‹é€ ã§é›£æ˜“åº¦ã‚’æ±ºã‚ã‚‹ 9. MVPã§ã€Œã‚„ã‚‰ãªã„ã“ã¨ï¼ˆé‡è¦ï¼‰ã€ è‡ªç”±å…¥åŠ›ã®æ–‡ç« å›ç­” æ¡ä»¶ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œã‚‹ å•é¡Œæ•°ã‚’å¢—ã‚„ã™ ğŸ‘‰ ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ç£¨ã 10. ã“ã‚Œã§ä½•ãŒã§ãã‚‹ã‹ ç„¡é™ç”Ÿæˆï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å·®ã—æ›¿ãˆï¼‰ æ€è€ƒãƒŸã‚¹ã®åˆ†é¡ãŒå¯èƒ½ è¨ºæ–­ã«ç›´çµ ä»–ã‚¿ã‚¤ãƒ—ï¼ˆæ’é™¤æ³•ãƒ»ä»®èª¬æ¤œè¨¼ï¼‰ã¸è‡ªç„¶ã«æ‹¡å¼µå¯èƒ½ PlayPage UIãƒ¯ã‚¤ãƒ¤ãƒ¼ï¼ˆæ¡ä»¶æ•´ç†å‹ï¼‰ ç”»é¢æ§‹æˆã®å…¨ä½“åƒ ä¸Šï¼šé€²æ—ãƒ»é›£æ˜“åº¦ãƒ»ä¸­æ–­ ä¸­ï¼šå•é¡Œæ–‡ï¼‹å›ç­”æ“ä½œ ä¸‹ï¼šæ€è€ƒãƒœãƒ¼ãƒ‰ï¼ˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯ãƒ»ãƒ¡ãƒ¢ãƒ»ä»®èª¬ï¼‰ å³ä¸‹ï¼šåˆ¤å®šãƒœã‚¿ãƒ³ï¼ˆå›ºå®šï¼‰ ã‚¹ãƒãƒ›ç‰ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ï¼ˆç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ€é©ï¼‰ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ [â†ä¸­æ–­] Q 3/10 â˜…â˜… â”‚ Header â”‚ ã‚¿ã‚¤ãƒãƒ¼ 00:42 ãƒ’ãƒ³ãƒˆ(ä»») â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ å•é¡Œæ–‡ï¼ˆçŸ­ã‚ã«ï¼‰ â”‚ â”‚ A/B/C ã¨ èµ¤é’ç·‘â€¦ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ã€æ¡ä»¶ã€‘ â”‚ Conditions (è¡¨ç¤ºã®ã¿) â”‚ 1. Aã¯èµ¤ã§ã¯ãªã„ â”‚ â”‚ 2. é’ã®äººã¯Bã§ã¯ãªã„ â”‚ â”‚ 3. ã‚‚ã—CãŒç·‘ãªã‚‰Aã¯é’ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ã€å›ç­”ã€‘ï¼ˆé¸æŠè‚¢ã‚«ãƒ¼ãƒ‰ï¼‰ â”‚ AnswerArea â”‚ (A) A=é’ B=èµ¤ C=ç·‘ â”‚ â”‚ (B) A=ç·‘ B=èµ¤ C=é’ â”‚ â”‚ (C) A=é’ B=ç·‘ C=èµ¤ â”‚ â”‚ (D) A=èµ¤ B=é’ C=ç·‘ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ã€æ€è€ƒãƒœãƒ¼ãƒ‰ã€‘ â”‚ ThinkingBoard â”‚ â–¼ æ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¿ãƒƒãƒ—ã§å±•é–‹ï¼‰â”‚ â”‚ [ ] æ¡ä»¶1ã‚’ä½¿ã£ãŸ â”‚ â”‚ [ ] æ¡ä»¶2ã‚’ä½¿ã£ãŸ â”‚ â”‚ [ ] æ¡ä»¶3ã‚’ä½¿ã£ãŸ â”‚ â”‚ â–¼ ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ ä»®èª¬ï¼ˆä»»æ„ï¼‰ â”‚ â”‚ [+ ä»®èª¬ã‚’è¿½åŠ ] [Aæ¡ˆ][Bæ¡ˆ] â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ åˆ¤å®šã™ã‚‹ï¼ˆå›ºå®šï¼‰ â”‚ Floating CTA â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ã‚¹ãƒãƒ›ã§ã®ã‚³ãƒ„ æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã¯æŠ˜ã‚ŠãŸãŸã¿ï¼ˆå¸¸ã«è¦‹ã›ã‚‹ã¨é•·ã„ï¼‰ ã€Œåˆ¤å®šã™ã‚‹ã€ã¯å›ºå®šãƒœã‚¿ãƒ³ï¼ˆè¿·å­é˜²æ­¢ï¼‰ é¸æŠè‚¢ã¯ã‚«ãƒ¼ãƒ‰ã§ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã PCç‰ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ï¼ˆ2ã‚«ãƒ©ãƒ ã§â€œè€ƒãˆã‚„ã™ã„â€ï¼‰ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ [â†ä¸­æ–­] Q 3/10 â˜…â˜… 00:42 ãƒ’ãƒ³ãƒˆ(ä»») â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ å·¦ï¼ˆå•é¡Œï¼‹å›ç­”ï¼‰ â”‚ å³ï¼ˆæ€è€ƒãƒœãƒ¼ãƒ‰ï¼‰ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ å•é¡Œæ–‡ â”‚ â”‚ â”‚ æ€è€ƒãƒœãƒ¼ãƒ‰ â”‚ â”‚ â”‚ â”‚ A/B/C ã¨ èµ¤é’ç·‘â€¦ â”‚ â”‚ â”‚ [æ¡ä»¶ãƒã‚§ãƒƒã‚¯] â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â–¡ æ¡ä»¶1 ä½¿ç”¨æ¸ˆã¿ â”‚ â”‚ â”‚ â”‚ æ¡ä»¶ä¸€è¦§ï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰ â”‚ â”‚ â”‚ â–¡ æ¡ä»¶2 ä½¿ç”¨æ¸ˆã¿ â”‚ â”‚ â”‚ â”‚ 1. Aã¯èµ¤ã§ã¯ãªã„ â”‚ â”‚ â”‚ â–¡ æ¡ä»¶3 ä½¿ç”¨æ¸ˆã¿ â”‚ â”‚ â”‚ â”‚ 2. é’ã®äººã¯Bã§ã¯ãªã„ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ 3. ã‚‚ã—CãŒç·‘ãªã‚‰Aã¯é’ â”‚ â”‚ â”‚ ãƒ¡ãƒ¢ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ [______________] â”‚ â”‚ â”‚ â”‚ å›ç­”ï¼ˆé¸æŠè‚¢ï¼‰ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ (A) A=é’ B=èµ¤ C=ç·‘ â”‚ â”‚ â”‚ ä»®èª¬ â”‚ â”‚ â”‚ â”‚ (B) A=ç·‘ B=èµ¤ C=é’ â”‚ â”‚ â”‚ [+è¿½åŠ ] [Aæ¡ˆ][Bæ¡ˆ]â”‚ â”‚ â”‚ â”‚ (C) A=é’ B=ç·‘ C=èµ¤ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ (D) A=èµ¤ B=é’ C=ç·‘ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ [ åˆ¤å®šã™ã‚‹ ] ReviewModalï¼ˆåˆ¤å®šãƒ»è§£èª¬ï¼‰ãƒ¯ã‚¤ãƒ¤ãƒ¼ï¼ˆMVPã®å·®åˆ¥åŒ–æ ¸ï¼‰ åˆ¤å®šã¯åˆ¥ãƒšãƒ¼ã‚¸ã§ã¯ãªããƒ¢ãƒ¼ãƒ€ãƒ«ãŒæœ€çŸ­ã§å¼·ã„ã§ã™ã€‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ âœ• â”‚ â”‚ çµæœï¼šä¸æ­£è§£ â”‚ ResultBadge â”‚ ã‚ãªãŸã®é¸æŠï¼šB â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ã©ã“ã§ã‚ºãƒ¬ãŸï¼Ÿï¼ˆé‡è¦ï¼‰ â”‚ â”‚ ãƒ»æ¡ä»¶2ã«é•åã—ã¦ã„ã¾ã™ â”‚ failedConditions â”‚ ã€Œé’ã®äººã¯Bã§ã¯ãªã„ã€ â”‚ â”‚ ãƒ»ã“ã®æ™‚ç‚¹ã§Bæ¡ˆã¯æˆç«‹ã—ã¾ã›ã‚“ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ æ€è€ƒã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰ â”‚ â”‚ ã€Œæ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‹ã‚‰ç¢ºå®šã™ã‚‹ã¨å¼·ã„ã€â”‚ â”‚ ä»Šå›ï¼šæ¡ä»¶ãƒã‚§ãƒƒã‚¯ 2/3 â”‚ â†ThinkingBoardãƒ­ã‚°åæ˜  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ [æ¬¡ã¸] â”‚ â”‚ ï¼ˆä»»æ„ï¼‰[åŒã˜å•é¡Œã‚’ã‚„ã‚Šç›´ã™] â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆï¼ˆMVPå¿…é ˆè¡¨ç¤ºï¼‰ ç ´ã£ãŸæ¡ä»¶ç•ªå·ï¼‹æ¡ä»¶æ–‡ã‚’å¿…ãšè¡¨ç¤º **æ¡ä»¶ãƒã‚§ãƒƒã‚¯ç‡ï¼ˆ2/3ï¼‰**ã®ã‚ˆã†ãªâ€œãƒ—ãƒ­ã‚»ã‚¹æŒ‡æ¨™â€ã‚’1ã¤å‡ºã™ æ“ä½œã®ãƒ«ãƒ¼ãƒ«ï¼ˆè¿·ã„ã‚’æ¶ˆã™ä»•æ§˜ï¼‰ é¸æŠè‚¢ã¯ 1ã¤é¸ã‚“ã ã‚‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ ã€Œåˆ¤å®šã™ã‚‹ã€ã¯ æœªé¸æŠæ™‚ã¯disabled ä¸­æ–­ã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° ãƒ’ãƒ³ãƒˆã¯ï¼ˆå…¥ã‚Œã‚‹ãªã‚‰ï¼‰ã€Œæ¡ä»¶ã‚’1ã¤å¼·èª¿ã€ç¨‹åº¦ã«ç•™ã‚ã‚‹ æ–‡è¨€ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆMVPã§çµ±ä¸€ï¼‰ ãƒœã‚¿ãƒ³ï¼šåˆ¤å®šã™ã‚‹ / æ¬¡ã¸ / ä¸­æ–­ / ã‚‚ã†ä¸€å› è§£èª¬è¦‹å‡ºã—ï¼šã€Œã©ã“ã§ã‚ºãƒ¬ãŸï¼Ÿã€ è¿½ã„æ‰“ã¡ã—ãªã„æ–‡ï¼š Ã—ã€Œé–“é•ã„ã§ã™ã€ â—‹ã€Œã“ã®æ¡ä»¶ãŒæœªæˆç«‹ã§ã™ã€ ã“ã‚Œã‚’ãã®ã¾ã¾å®Ÿè£…ã‚¿ã‚¹ã‚¯ã«åˆ†è§£ï¼ˆæœ€çŸ­ï¼‰ QuestionHeader ProblemStatement + ConditionsList ChoicesListï¼ˆã‚«ãƒ¼ãƒ‰UIï¼‰ ThinkingBoardï¼ˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯ã ã‘å…ˆã«ï¼‰ ReviewModalï¼ˆfailedConditionsè¡¨ç¤ºï¼‰ Nextã§Qé€²è¡Œ 1) domainå´ã®åŸºæœ¬å‹ï¼ˆå†æ²ï¼‹MVPæœ€å°ï¼‰ export type Difficulty = 1 | 2 | 3; export type ThinkType = "recommended" | "condition" | "elimination" | "ordering" | "hypothesis"; export type Condition = | { id: string; type: "equals"; entity: string; attribute: string; label?: string } | { id: string; type: "notEquals"; entity: string; attribute: string; label?: string } | { id: string; type: "ifThen"; if: Condition; then: Condition; label?: string }; export type Choice = { id: string; // "A" | "B" | "C" | "D" ã§ã‚‚OK mapping: Record<string, string>; // { A:"é’", B:"èµ¤", C:"ç·‘" } label?: string; // UIè¡¨ç¤ºç”¨ï¼ˆè‡ªå‹•ç”Ÿæˆã§OKï¼‰ }; export type ConditionProblem = { id: string; type: "condition"; difficulty: Difficulty; entities: string[]; attributes: string[]; conditions: Condition[]; question: string; choices: Choice[]; correctChoiceId: string; }; 2) ThinkingBoardï¼ˆæ€è€ƒãƒœãƒ¼ãƒ‰ï¼‰çŠ¶æ…‹å‹ MVPã¯ã“ã‚Œã§ååˆ†ï¼ˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼‹ãƒ¡ãƒ¢ï¼‹ä»®èª¬ãƒãƒƒãƒ—ï¼‰ã€‚ export type ThinkingDraft = { checkedConditionIds: string[]; // Condition.id ã®é…åˆ— memo: string; hypotheses: string[]; // æ–‡å­—åˆ—ãƒãƒƒãƒ—ï¼ˆ"Aæ¡ˆ"ãªã©ï¼‰ ã¾ãšã¯æ–‡å­—åˆ—ã§OK }; ã€Œã©ã®æ¡ä»¶ã‚’ä½¿ã£ãŸã‹ã€ã‚’ Condition.id ã§æŒã¤ã®ãŒã‚³ã‚¢ã€‚ å¾Œã§ãƒ­ã‚°ï¼ˆæ™‚ç³»åˆ—ï¼‰ã‚’è¶³ã—ãŸããªã£ãŸã‚‰ events[] ã‚’è¿½åŠ ã™ã‚Œã°OKã€‚ 3) åˆ¤å®šçµæœï¼ˆReviewModalã«å¿…è¦ï¼‰ export type ValidationResult = { isCorrect: boolean; selectedChoiceId: string; failedConditionIds: string[]; // ç ´ã£ãŸæ¡ä»¶ï¼ˆCondition.idï¼‰ // MVPã®èª¤ç­”ç†ç”±ãƒ†ãƒ³ãƒ—ãƒ¬ç”¨ï¼ˆå°†æ¥æ‹¡å¼µï¼‰ reasonCode?: "condition_miss" | "condition_misread" | "logic_jump"; }; 4) UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® props è¨­è¨ˆ 4-1) QuestionHeader export type QuestionHeaderProps = { currentIndex: number; // 0-based total: number; // 10 difficulty: Difficulty; elapsedSec?: number; // ã‚¿ã‚¤ãƒãƒ¼ï¼ˆä»»æ„ï¼‰ onAbort: () => void; // ä¸­æ–­ onHint?: () => void; // ãƒ’ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰ }; 4-2) ProblemStatement export type ProblemStatementProps = { question: string; }; 4-3) ConditionsListï¼ˆè¡¨ç¤ºç”¨ï¼‰ export type ConditionsListProps = { conditions: Condition[]; // æ¡ä»¶æ–‡ã®è¡¨ç¤ºæ–¹æ³•ã‚’çµ±ä¸€ã™ã‚‹ãŸã‚ã« renderer ã‚’æ³¨å…¥ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆä»»æ„ï¼‰ renderConditionLabel?: (c: Condition, index: number) => string; }; label ã‚’ Condition ã«æŒãŸã›ã¦ã‚‚ã„ã„ã‘ã©ã€ æœ€åˆã¯ render é–¢æ•°ã§æ–‡ç« åŒ–ã™ã‚‹ã¨æŸ”è»Ÿã§ã™ï¼ˆifThenã‚’è‡ªç„¶æ–‡ã«ã—ã‚„ã™ã„ï¼‰ã€‚ 4-4) ChoicesListï¼ˆå›ç­”ã‚«ãƒ¼ãƒ‰ï¼‰ export type ChoicesListProps = { entities: string[]; // ["A","B","C"] choices: Choice[]; // mapping ã‚’è¡¨ç¤ºã™ã‚‹ selectedChoiceId: string | null; onSelect: (choiceId: string) => void; }; è¡¨ç¤ºã¯ choices ã® mapping ã‹ã‚‰ A=é’ / B=èµ¤ / C=ç·‘ ã¿ãŸã„ã«çµ„ã¿ç«‹ã¦ã‚Œã°OKã€‚ 4-5) SubmitBarï¼ˆåˆ¤å®šã™ã‚‹å›ºå®šCTAï¼‰ export type SubmitBarProps = { canSubmit: boolean; // é¸æŠè‚¢æœªé¸æŠãªã‚‰false onSubmit: () => void; }; ï¼ˆä»»æ„ã§ onOpenThinkingBoard ã‚„ onHint ã‚’è¶³ã—ã¦ã‚‚OKï¼‰ 4-6) ThinkingBoardï¼ˆå·®åˆ¥åŒ–ã‚³ã‚¢ï¼‰ export type ThinkingBoardProps = { conditions: Condition[]; draft: ThinkingDraft; onChange: (next: ThinkingDraft) => void; // æŠ˜ã‚ŠãŸãŸã¿ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰ collapsible?: boolean; }; ã¾ãšã¯ onChange ã§ä¸¸ã”ã¨è¿”ã™ã®ãŒå®Ÿè£…ãŒé€Ÿã„ã§ã™ã€‚ å¾Œã§ç´°ã‹ãã™ã‚‹ãªã‚‰ onToggleCondition / onMemoChange ã«åˆ†ã‘ã‚Œã°OKã€‚ 4-7) ReviewModalï¼ˆåˆ¤å®šãƒ»è§£èª¬ï¼‰ export type ReviewModalProps = { isOpen: boolean; problem: ConditionProblem; draftAtSubmit: ThinkingDraft; // åˆ¤å®šæ™‚ç‚¹ã®æ€è€ƒãƒœãƒ¼ãƒ‰ï¼ˆãƒã‚§ãƒƒã‚¯ç‡è¡¨ç¤ºç”¨ï¼‰ result: ValidationResult | null; // null ã®ã¨ãã¯éè¡¨ç¤ºã§ã‚‚OK onClose: () => void; // âœ• onNext: () => void; // æ¬¡ã¸ onRetry?: () => void; // ä»»æ„ï¼šåŒå•é¡Œã‚„ã‚Šç›´ã— }; ReviewModal å†…ã§æœ€ä½é™è¡¨ç¤ºã™ã¹ãæƒ…å ±ã¯ï¼š æ­£èª¤ failedConditionIds â†’ æ¡ä»¶æ–‡ã®è¡¨ç¤º checkedConditionIds ã®æ•° / å…¨æ¡ä»¶æ•°ï¼ˆãƒã‚§ãƒƒã‚¯ç‡ï¼‰ 5) PlayPage ã‚’çµ„ã¿ç«‹ã¦ã‚‹ãŸã‚ã®ã€Œãƒšãƒ¼ã‚¸ç”¨ propsã€ï¼ˆä»»æ„ï¼‰ Zustandã‚’ä½¿ã†ãªã‚‰ä¸è¦ã ã‘ã©ã€æ§‹é€ æŠŠæ¡ã«ä¾¿åˆ©ãªã®ã§ä¸€å¿œã€‚ export type PlayPageViewModel = { problem: ConditionProblem; currentIndex: number; total: number; selectedChoiceId: string | null; thinkingDraft: ThinkingDraft; elapsedSec?: number; // review isReviewOpen: boolean; validationResult: ValidationResult | null; draftAtSubmit: ThinkingDraft | null; }; 6) å®Ÿè£…ã®æœ€çŸ­ãƒ«ãƒ¼ãƒ«ï¼ˆã“ã‚Œã ã‘å®ˆã‚Œã°è©°ã¾ã‚‰ãªã„ï¼‰ thinkingDraft ã¯ PlayPage ãŒä¿æŒï¼ˆStoreã§ã‚‚OKï¼‰ onSubmit ã§ draftAtSubmit = thinkingDraft ã‚’å›ºå®š validate() ã—ã¦ validationResult ã‚’ç”Ÿæˆ ReviewModal open onNext ã§ æ¬¡ã®å•é¡Œã¸ï¼ˆdraft/selectedã‚’ãƒªã‚»ãƒƒãƒˆï¼‰ 10å•ç›®ãªã‚‰ /result src/pages/PlayPage.tsxï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰ import React, { useMemo, useState } from "react"; import { useNavigate } from "react-router-dom"; // ===== domain types (å¿…è¦ãªã‚‰åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¸ç§»å‹•) ===== type Difficulty = 1 | 2 | 3; type Condition = | { id: string; type: "equals"; entity: string; attribute: string; label?: string } | { id: string; type: "notEquals"; entity: string; attribute: string; label?: string } | { id: string; type: "ifThen"; if: Condition; then: Condition; label?: string }; type Choice = { id: string; // "A" etc mapping: Record<string, string>; }; type ConditionProblem = { id: string; type: "condition"; difficulty: Difficulty; entities: string[]; attributes: string[]; conditions: Condition[]; question: string; choices: Choice[]; correctChoiceId: string; }; type ThinkingDraft = { checkedConditionIds: string[]; memo: string; hypotheses: string[]; }; type ValidationResult = { isCorrect: boolean; selectedChoiceId: string; failedConditionIds: string[]; reasonCode?: "condition_miss" | "condition_misread" | "logic_jump"; }; // ===== helpers ===== function defaultDraft(): ThinkingDraft { return { checkedConditionIds: [], memo: "", hypotheses: [] }; } // MVPç”¨ï¼šæ¡ä»¶â†’æ–‡ç« ï¼ˆlabelãŒã‚ã‚Œã°ãã‚Œã‚’å„ªå…ˆï¼‰ function renderConditionLabel(c: Condition): string { if (c.label) return c.label; if (c.type === "equals") return ${c.entity} ã¯ ${c.attribute} ã§ã‚ã‚‹; if (c.type === "notEquals") return ${c.entity} ã¯ ${c.attribute} ã§ã¯ãªã„; // ifThen return ã‚‚ã—ï¼ˆ${renderConditionLabel(c.if)}ï¼‰ãªã‚‰ï¼ˆ${renderConditionLabel(c.then)}ï¼‰; } // MVPç”¨ï¼šä»® validatorï¼ˆä»Šã¯ã€Œæ­£è§£é¸æŠè‚¢ã‹ã©ã†ã‹ã€ã ã‘ã§å‹•ã‹ã™ï¼‰ // â€»æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã§æœ¬ç‰©ã® validate() ã«å·®ã—æ›¿ãˆ function validateMvp(problem: ConditionProblem, selectedChoiceId: string): ValidationResult { const isCorrect = selectedChoiceId === problem.correctChoiceId; return { isCorrect, selectedChoiceId, failedConditionIds: isCorrect ? [] : [problem.conditions[0]?.id].filter(Boolean) as string[], reasonCode: isCorrect ? undefined : "condition_miss", }; } // ===== UI components (MVPæœ€å°ãƒ»å¾Œã§åˆ†å‰²æ¨å¥¨) ===== function QuestionHeader(props: { currentIndex: number; total: number; difficulty: Difficulty; onAbort: () => void; }) { const { currentIndex, total, difficulty, onAbort } = props; return ( <div className="flex items-center justify-between gap-2 p-3 border-b"> <button className="px-3 py-2 rounded-xl border" onClick={onAbort}> â† ä¸­æ–­ </button> <div className="text-sm"> Q {currentIndex + 1}/{total} <span className="ml-2">{"â˜…".repeat(difficulty)}</span> </div> <div className="w-20" /> </div> ); } function ChoicesList(props: { entities: string[]; choices: Choice[]; selectedChoiceId: string | null; onSelect: (id: string) => void; }) { const { entities, choices, selectedChoiceId, onSelect } = props; return ( <div className="grid gap-2"> {choices.map((c) => { const selected = c.id === selectedChoiceId; const line = entities.map((e) => ${e}=${c.mapping[e]}).join(" / "); return ( <button key={c.id} className={[ "text-left p-3 rounded-2xl border shadow-sm", selected ? "border-black" : "border-gray-200", ].join(" ")} onClick={() => onSelect(c.id)} > <div className="text-sm font-semibold">({c.id})</div> <div className="text-sm">{line}</div> </button> ); })} </div> ); } function ThinkingBoard(props: { conditions: Condition[]; draft: ThinkingDraft; onChange: (next: ThinkingDraft) => void; }) { const { conditions, draft, onChange } = props; const toggle = (condId: string) => { const has = draft.checkedConditionIds.includes(condId); const next = has ? draft.checkedConditionIds.filter((x) => x !== condId) : [...draft.checkedConditionIds, condId]; onChange({ ...draft, checkedConditionIds: next }); }; const addHypothesis = () => { const name = ä»®èª¬${draft.hypotheses.length + 1}; onChange({ ...draft, hypotheses: [...draft.hypotheses, name] }); }; const removeHypothesis = (name: string) => { onChange({ ...draft, hypotheses: draft.hypotheses.filter((h) => h !== name) }); }; return ( <div className="p-3 rounded-2xl border"> <div className="font-semibold mb-2">æ€è€ƒãƒœãƒ¼ãƒ‰</div> <div className="mb-3"> <div className="text-sm font-semibold mb-1">æ¡ä»¶ãƒã‚§ãƒƒã‚¯</div> <div className="grid gap-1"> {conditions.map((c, idx) => { const label = ${idx + 1}. ${renderConditionLabel(c)}; const checked = draft.checkedConditionIds.includes(c.id); return ( <label key={c.id} className="flex items-start gap-2 text-sm cursor-pointer select-none"> <input type="checkbox" checked={checked} onChange={() => toggle(c.id)} className="mt-1" /> <span>{label}</span> </label> ); })} </div> </div> <div className="mb-3"> <div className="text-sm font-semibold mb-1">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</div> <textarea value={draft.memo} onChange={(e) => onChange({ ...draft, memo: e.target.value })} className="w-full min-h-20 p-2 rounded-xl border" placeholder="æ°—ã¥ã„ãŸã“ã¨ã‚’ãƒ¡ãƒ¢â€¦" /> </div> <div> <div className="text-sm font-semibold mb-1">ä»®èª¬ï¼ˆä»»æ„ï¼‰</div> <div className="flex flex-wrap gap-2 mb-2"> {draft.hypotheses.map((h) => ( <button key={h} className="px-3 py-1 rounded-full border text-sm" onClick={() => removeHypothesis(h)} title="ã‚¯ãƒªãƒƒã‚¯ã§å‰Šé™¤" > {h} âœ• </button> ))} </div> <button className="px-3 py-2 rounded-xl border" onClick={addHypothesis}> + ä»®èª¬ã‚’è¿½åŠ  </button> </div> </div> ); } function ReviewModal(props: { isOpen: boolean; problem: ConditionProblem; result: ValidationResult | null; draftAtSubmit: ThinkingDraft | null; onClose: () => void; onNext: () => void; }) { const { isOpen, problem, result, draftAtSubmit, onClose, onNext } = props; if (!isOpen || !result || !draftAtSubmit) return null; const total = problem.conditions.length; const checked = draftAtSubmit.checkedConditionIds.length; const failedLabels = result.failedConditionIds .map((id) => problem.conditions.find((c) => c.id === id)) .filter(Boolean) .map((c) => renderConditionLabel(c as Condition)); return ( <div className="fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center p-3 z-50"> <div className="w-full sm:max-w-xl bg-white rounded-3xl p-4 shadow-xl"> <div className="flex justify-between items-center mb-2"> <div className="font-semibold">åˆ¤å®š</div> <button className="px-3 py-2 rounded-xl border" onClick={onClose}> âœ• </button> </div> <div className="mb-3"> <div className="text-lg font-semibold"> çµæœï¼š{result.isCorrect ? "æ­£è§£" : "ä¸æ­£è§£"} </div> <div className="text-sm">ã‚ãªãŸã®é¸æŠï¼š{result.selectedChoiceId}</div> </div> {!result.isCorrect && ( <div className="mb-3 p-3 rounded-2xl border"> <div className="font-semibold mb-1">ã©ã“ã§ã‚ºãƒ¬ãŸï¼Ÿ</div> <ul className="list-disc pl-5 text-sm"> {failedLabels.length > 0 ? ( failedLabels.map((t, i) => <li key={i}>{t}</li>) ) : ( <li>æ¡ä»¶ã®é©ç”¨ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li> )} </ul> </div> )} <div className="mb-3 p-3 rounded-2xl border"> <div className="font-semibold mb-1">æ€è€ƒã‚¢ãƒ‰ãƒã‚¤ã‚¹</div> <div className="text-sm"> æ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼š{checked}/{total} </div> {!result.isCorrect && checked < total && ( <div className="text-sm mt-1">æœªãƒã‚§ãƒƒã‚¯ã®æ¡ä»¶ãŒæ®‹ã£ãŸã¾ã¾çµè«–ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚</div> )} </div> <button className="w-full py-3 rounded-2xl border font-semibold" onClick={onNext}> æ¬¡ã¸ </button> </div> </div> ); } // ===== PlayPage ===== export default function PlayPage() { const navigate = useNavigate(); // æœ¬æ¥ã¯ store ã‹ã‚‰å–ã‚‹æƒ³å®šã€‚MVPãƒ†ãƒ³ãƒ—ãƒ¬ã§ã¯ useState ã§ä»®ç½®ãã€‚ const total = 10; const currentIndex = 0; // ä»®ã®å•é¡Œï¼ˆã‚ã¨ã§ generator ã‹ã‚‰ä¾›çµ¦ã™ã‚‹ï¼‰ const problem: ConditionProblem = useMemo( () => ({ id: "p1", type: "condition", difficulty: 2, entities: ["A", "B", "C"], attributes: ["èµ¤", "é’", "ç·‘"], question: "Aãƒ»Bãƒ»C ã®3äººãŒã€ãã‚Œãã‚Œ èµ¤ãƒ»é’ãƒ»ç·‘ ã®ã„ãšã‚Œã‹ã®å¸½å­ã‚’ã‹ã¶ã£ã¦ã„ã¾ã™ã€‚æ¬¡ã®æ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™çµ„ã¿åˆã‚ã›ã¯ã©ã‚Œã§ã—ã‚‡ã†ï¼Ÿ", conditions: [ { id: "c1", type: "notEquals", entity: "A", attribute: "èµ¤", label: "Aã¯èµ¤ã§ã¯ãªã„" }, { id: "c2", type: "notEquals", entity: "B", attribute: "é’", label: "é’ã‚’ã‹ã¶ã£ã¦ã„ã‚‹äººã¯Bã§ã¯ãªã„" }, { id: "c3", type: "ifThen", if: { id: "c3_if", type: "equals", entity: "C", attribute: "ç·‘" }, then: { id: "c3_then", type: "equals", entity: "A", attribute: "é’" }, label: "ã‚‚ã—CãŒç·‘ãªã‚‰ã€Aã¯é’ã§ã‚ã‚‹", }, ], choices: [ { id: "A", mapping: { A: "é’", B: "èµ¤", C: "ç·‘" } }, { id: "B", mapping: { A: "ç·‘", B: "èµ¤", C: "é’" } }, { id: "C", mapping: { A: "é’", B: "ç·‘", C: "èµ¤" } }, { id: "D", mapping: { A: "èµ¤", B: "é’", C: "ç·‘" } }, ], correctChoiceId: "A", }), [] ); const [selectedChoiceId, setSelectedChoiceId] = useState<string | null>(null); const [draft, setDraft] = useState<ThinkingDraft>(defaultDraft()); const [isReviewOpen, setIsReviewOpen] = useState(false); const [result, setResult] = useState<ValidationResult | null>(null); const [draftAtSubmit, setDraftAtSubmit] = useState<ThinkingDraft | null>(null); const onAbort = () => { const ok = window.confirm("é€²è¡Œä¸­ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’ä¸­æ–­ã—ã¾ã™ã‹ï¼Ÿ"); if (ok) navigate("/"); }; const onSubmit = () => { if (!selectedChoiceId) return; const fixedDraft = { ...draft }; setDraftAtSubmit(fixedDraft); setResult(validateMvp(problem, selectedChoiceId)); setIsReviewOpen(true); }; const onNext = () => { // æœ¬æ¥ã¯æ¬¡ã®å•é¡Œã¸ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ã§ã¯ result ãƒšãƒ¼ã‚¸ã¸é£›ã°ã™ä¾‹ã€‚ setIsReviewOpen(false); navigate("/result"); }; return ( <div className="min-h-dvh flex flex-col"> <QuestionHeader currentIndex={currentIndex} total={total} difficulty={problem.difficulty} onAbort={onAbort} /> <div className="flex-1 p-3 max-w-5xl w-full mx-auto grid gap-3 lg:grid-cols-[1fr_360px]"> {/* Left: problem + choices */} <div className="grid gap-3"> <div className="p-3 rounded-2xl border"> <div className="font-semibold mb-2">å•é¡Œ</div> <div className="text-sm leading-relaxed">{problem.question}</div> </div> <div className="p-3 rounded-2xl border"> <div className="font-semibold mb-2">æ¡ä»¶</div> <ol className="list-decimal pl-5 text-sm grid gap-1"> {problem.conditions.map((c, i) => ( <li key={c.id}>{renderConditionLabel(c)}</li> ))} </ol> </div> <div className="p-3 rounded-2xl border"> <div className="font-semibold mb-2">å›ç­”</div> <ChoicesList entities={problem.entities} choices={problem.choices} selectedChoiceId={selectedChoiceId} onSelect={setSelectedChoiceId} /> </div> </div> {/* Right: thinking board */} <div className="lg:sticky lg:top-3 h-fit"> <ThinkingBoard conditions={problem.conditions} draft={draft} onChange={setDraft} /> </div> </div> {/* Fixed submit bar */} <div className="sticky bottom-0 p-3 border-t bg-white"> <button className={[ "w-full py-3 rounded-2xl border font-semibold", selectedChoiceId ? "" : "opacity-40 cursor-not-allowed", ].join(" ")} disabled={!selectedChoiceId} onClick={onSubmit} > åˆ¤å®šã™ã‚‹ </button> </div> <ReviewModal isOpen={isReviewOpen} problem={problem} result={result} draftAtSubmit={draftAtSubmit} onClose={() => setIsReviewOpen(false)} onNext={onNext} /> </div> ); } 1) validatorï¼ˆMVPå®Ÿè£…ï¼‰ã‚³ãƒ¼ãƒ‰ src/domain/validator/conditionValidator.ts ã¿ãŸã„ãªå ´æ‰€ã«ç½®ãæƒ³å®šã§ã™ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚OKï¼‰ã€‚ // ===== typesï¼ˆæ—¢å­˜ã®ã‚‚ã®ã‚’ import ã—ã¦OKï¼‰===== export type Condition = | { id: string; type: "equals"; entity: string; attribute: string; label?: string } | { id: string; type: "notEquals"; entity: string; attribute: string; label?: string } | { id: string; type: "ifThen"; if: Condition; then: Condition; label?: string }; export type Choice = { id: string; mapping: Record<string, string>; // { A:"é’", B:"èµ¤", C:"ç·‘" } }; export type ConditionProblem = { id: string; type: "condition"; conditions: Condition[]; choices: Choice[]; correctChoiceId: string; // ã“ã‚Œã¯ã€Œç”Ÿæˆæ™‚ã«çœŸã€ã§ã‚‚è‰¯ã„ãŒã€validateã§ã¯ä½¿ã‚ãªãã¦OK }; export type ValidationResult = { isCorrect: boolean; selectedChoiceId: string; failedConditionIds: string[]; reasonCode?: "condition_miss" | "condition_misread" | "logic_jump"; }; // ===== core ===== // å˜ä¸€æ¡ä»¶ã‚’è©•ä¾¡ï¼ˆchoice.mapping ã‚’å‚ç…§ï¼‰ export function checkCondition(cond: Condition, mapping: Record<string, string>): boolean { switch (cond.type) { case "equals": { const actual = mapping[cond.entity]; // entityãŒå­˜åœ¨ã—ãªã„å ´åˆã¯å®‰å…¨å´ã§ falseï¼ˆå•é¡Œãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆï¼‰ if (actual === undefined) return false; return actual === cond.attribute; } case "notEquals": { const actual = mapping[cond.entity]; if (actual === undefined) return false; return actual !== cond.attribute; } case "ifThen": { // è«–ç†: (if ãŒçœŸ) â†’ (then ã‚‚çœŸ) ãŒå¿…è¦ // ã¤ã¾ã‚Š: if ãŒå½ãªã‚‰å…¨ä½“ã¯çœŸï¼ˆæ¡ä»¶ã¯æº€ãŸã•ã‚Œã‚‹ï¼‰ const ifTrue = checkCondition(cond.if, mapping); if (!ifTrue) return true; return checkCondition(cond.then, mapping); } default: { // å°†æ¥å‹ãŒå¢—ãˆãŸå ´åˆã«å‚™ãˆã¦ const _exhaustive: never = cond; return _exhaustive; } } } // è¤‡æ•°æ¡ä»¶ã‚’è©•ä¾¡ã—ã€ç ´ã£ãŸæ¡ä»¶IDã‚’åé›† export function validateConditionProblem(problem: ConditionProblem, selectedChoiceId: string): ValidationResult { const choice = problem.choices.find((c) => c.id === selectedChoiceId); if (!choice) { return { isCorrect: false, selectedChoiceId, failedConditionIds: problem.conditions.map((c) => c.id), reasonCode: "condition_misread", }; } const failed: string[] = []; for (const cond of problem.conditions) { const ok = checkCondition(cond, choice.mapping); if (!ok) failed.push(cond.id); } // æ­£è§£åˆ¤å®šã¯ã€Œæ¡ä»¶ã‚’å…¨éƒ¨æº€ãŸã™ã‹ã€ã§æ±ºã‚ã‚‹ï¼ˆcorrectChoiceIdã«ä¾å­˜ã—ãªã„ï¼‰ const isCorrect = failed.length === 0; // MVPã® reason æ¨å®šï¼ˆé›‘ã§OKã€å¾Œã§æ”¹å–„ï¼‰ const reasonCode: ValidationResult["reasonCode"] | undefined = isCorrect ? undefined : failed.some((id) => { const c = problem.conditions.find((x) => x.id === id); return c?.type === "ifThen"; }) ? "logic_jump" : failed.length >= 2 ? "condition_miss" : "condition_misread"; return { isCorrect, selectedChoiceId, failedConditionIds: failed, reasonCode, }; } 2) PlayPage å´ã®å·®ã—æ›¿ãˆï¼ˆè¶…ç°¡å˜ï¼‰ PlayPage ã® validateMvp() ã‚’å‰Šé™¤ã—ã¦ã€ã“ã‚Œã«ç½®ãæ›ãˆã€‚ import { validateConditionProblem } from "../domain/validator/conditionValidator"; ... const onSubmit = () => { if (!selectedChoiceId) return; const fixedDraft = { ...draft }; setDraftAtSubmit(fixedDraft); setResult(validateConditionProblem(problem, selectedChoiceId)); // â†ã“ã“ setIsReviewOpen(true); }; 1) è§£èª¬ç”Ÿæˆã®å…¥åŠ›ãƒ»å‡ºåŠ›ï¼ˆMVPï¼‰ å…¥åŠ›ï¼ˆã™ã§ã«ã‚ã‚‹æƒ…å ±ï¼‰ result.failedConditionIdsï¼ˆç ´ã£ãŸæ¡ä»¶ï¼‰ draftAtSubmit.checkedConditionIdsï¼ˆæ¤œè¨ã—ãŸæ¡ä»¶ï¼‰ problem.conditionsï¼ˆæ¡ä»¶æ–‡ï¼‰ å‡ºåŠ›ï¼ˆReviewModalã«è¡¨ç¤ºï¼‰ titleï¼šã©ã“ã§ã‚ºãƒ¬ãŸï¼Ÿ bulletsï¼šç ´ç¶»ãƒã‚¤ãƒ³ãƒˆï¼ˆæ¡ä»¶é•åã®åˆ—æŒ™ï¼‰ adviceï¼šæ€è€ƒã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆ1ã€œ2è¡Œï¼‰ processHintï¼šãƒ—ãƒ­ã‚»ã‚¹æŒ‡æ¨™ï¼ˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯ç‡ãªã©ï¼‰ 2) explainãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãã®ã¾ã¾ä½¿ãˆã‚‹ã‚³ãƒ¼ãƒ‰ï¼‰ src/domain/explain/conditionExplain.ts ãªã©ã«é…ç½®æƒ³å®šã€‚ import type { Condition, ValidationResult } from "../validator/conditionValidator"; export type ExplainPayload = { failedBullets: string[]; // ã€Œæ¡ä»¶2ã«é•åã€ãªã© adviceTitle: string; // ã€Œæ€è€ƒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€ adviceLines: string[]; // 1ã€œ2è¡Œ processLines: string[]; // ã€Œæ¡ä»¶ãƒã‚§ãƒƒã‚¯ 2/3ã€ãªã© }; function isIfThen(cond: Condition): boolean { return cond.type === "ifThen"; } export function buildExplainPayload(args: { conditions: Condition[]; result: ValidationResult; checkedConditionIds: string[]; renderConditionLabel: (c: Condition) => string; }): ExplainPayload { const { conditions, result, checkedConditionIds, renderConditionLabel } = args; const total = conditions.length; const checkedCount = checkedConditionIds.length; // failed condition objects const failedConds = result.failedConditionIds .map((id) => conditions.find((c) => c.id === id)) .filter((c): c is Condition => Boolean(c)); // --- failed bulletsï¼ˆç¢ºå®Ÿã«è¨€ãˆã‚‹äº‹å®Ÿã ã‘ï¼‰ --- const failedBullets = failedConds.length > 0 ? failedConds.map((c, idx) => æ¡ä»¶é•åï¼š${renderConditionLabel(c)}) : ["æ¡ä»¶ã®é©ç”¨ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰"]; // --- ãƒ—ãƒ­ã‚»ã‚¹æŒ‡æ¨™ --- const processLines: string[] = [æ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼š${checkedCount}/${total}]; // --- æ¨å®šï¼ˆæ§ãˆã‚ï¼‰ --- const failedSet = new Set(result.failedConditionIds); const checkedSet = new Set(checkedConditionIds); // ç ´ã£ãŸæ¡ä»¶ã®ã†ã¡ã€æœªãƒã‚§ãƒƒã‚¯ã ã£ãŸã‚‚ã® const missedFailed = result.failedConditionIds.filter((id) => !checkedSet.has(id)); // ifThen ã‚’ç ´ã£ãŸã‹ const failedIfThen = failedConds.some(isIfThen); // è¤‡æ•°é•å const multiFail = result.failedConditionIds.length >= 2; // --- adviceï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬é¸æŠï¼‰ --- const adviceLines: string[] = []; // 1) æœªãƒã‚§ãƒƒã‚¯ã®æ¡ä»¶ã§è½ã¡ãŸ â†’ ã€Œæœªæ¤œè¨ã®æ¡ä»¶ãŒã‚ã‚‹ã€ if (missedFailed.length > 0) { adviceLines.push("æœªãƒã‚§ãƒƒã‚¯ã®æ¡ä»¶ãŒæ®‹ã£ãŸã¾ã¾çµè«–ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚"); adviceLines.push("æ¬¡ã¯ã€Œæ¡ä»¶ã‚’å…¨éƒ¨ãƒã‚§ãƒƒã‚¯ã—ã¦ã‹ã‚‰ã€é¸æŠè‚¢ã‚’ç¢ºå®šã™ã‚‹ã¨å®‰å®šã—ã¾ã™ã€‚"); } // 2) ifThen ã§è½ã¡ãŸ â†’ ä»®å®šã®æ‰±ã„ else if (failedIfThen) { adviceLines.push("ã€Œã‚‚ã—ã€œãªã‚‰ã€ã®æ¡ä»¶ã¯ã€å‰æãŒæˆã‚Šç«‹ã¤æ™‚ã ã‘è¿½åŠ ã§æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"); adviceLines.push("ã¾ãšå‰æï¼ˆã‚‚ã—ã®éƒ¨åˆ†ï¼‰ãŒæœ¬å½“ã«çœŸã‹ã‚’ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚"); } // 3) è¤‡æ•°é•å â†’ æ¡ä»¶æ•´ç†ä¸è¶³ else if (multiFail) { adviceLines.push("è¤‡æ•°ã®æ¡ä»¶ã§ç ´ç¶»ã—ã¦ã„ã¾ã™ã€‚"); adviceLines.push("1ã¤ãšã¤æ¡ä»¶ã‚’å½“ã¦ã¯ã‚ã¦ã€æˆç«‹ã—ãªã„é¸æŠè‚¢ã‚’å…ˆã«æ¶ˆã™ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚"); } // 4) å˜ç™ºé•å â†’ èª­ã¿é–“é•ã„ or å½“ã¦ã¯ã‚ä¸è¶³ else { adviceLines.push("1ã¤ã®æ¡ä»¶ã§ç ´ç¶»ã—ã¦ã„ã¾ã™ã€‚"); adviceLines.push("ãã®æ¡ä»¶ã‚’å½“ã¦ã¯ã‚ç›´ã™ã¨ã€ç­”ãˆãŒã™ãçµã‚Œã¾ã™ã€‚"); } // è¿½åŠ ã§ã€Œã©ã®æ¡ä»¶ãŒæœªãƒã‚§ãƒƒã‚¯ã ã£ãŸã‹ã€ã‚‚å‡ºã›ã‚‹ï¼ˆMVPã¯å‡ºã—ã™ãæ³¨æ„ï¼‰ if (missedFailed.length > 0) { const missedLabels = missedFailed .map((id) => conditions.find((c) => c.id === id)) .filter((c): c is Condition => Boolean(c)) .map((c) => renderConditionLabel(c)); if (missedLabels.length > 0) { processLines.push(æœªãƒã‚§ãƒƒã‚¯ã§è½ã¡ãŸæ¡ä»¶ï¼š${missedLabels.join(" / ")}); } } return { failedBullets, adviceTitle: "æ€è€ƒã‚¢ãƒ‰ãƒã‚¤ã‚¹", adviceLines, processLines, }; } 3) ReviewModal ã«çµ„ã¿è¾¼ã‚€ï¼ˆå·®ã—æ›¿ãˆæ‰‹é †ï¼‰ ReviewModal å†…ã§ failedLabels ã‚’ä½œã£ã¦ã„ãŸéƒ¨åˆ†ã‚’ã€ä¸Šã® buildExplainPayload() ã«ç½®ãæ›ãˆã¾ã™ã€‚ ä¾‹ï¼šPlayPage.tsx ã® ReviewModal ã®ä¸­ã§ import { buildExplainPayload } from "../domain/explain/conditionExplain"; ... const payload = buildExplainPayload({ conditions: problem.conditions, result, checkedConditionIds: draftAtSubmit.checkedConditionIds, renderConditionLabel, }); ãã—ã¦è¡¨ç¤ºï¼š {!result.isCorrect && ( <div className="mb-3 p-3 rounded-2xl border"> <div className="font-semibold mb-1">ã©ã“ã§ã‚ºãƒ¬ãŸï¼Ÿ</div> <ul className="list-disc pl-5 text-sm"> {payload.failedBullets.map((t, i) => <li key={i}>{t}</li>)} </ul> </div> )} <div className="mb-3 p-3 rounded-2xl border"> <div className="font-semibold mb-1">{payload.adviceTitle}</div> <div className="text-sm grid gap-1"> {payload.adviceLines.map((t, i) => <div key={i}>{t}</div>)} </div> <div className="text-sm mt-2 opacity-80 grid gap-1"> {payload.processLines.map((t, i) => <div key={i}>{t}</div>)} </div> </div> 4) ã“ã®æ–¹å¼ã®è‰¯ã„ã¨ã“ã‚ï¼ˆMVPå‘ãï¼‰ **ç¢ºå®Ÿã«è¨€ãˆã‚‹äº‹å®Ÿï¼ˆç ´ã£ãŸæ¡ä»¶ï¼‰**ã‚’è»¸ã«ã™ã‚‹ã®ã§å¤–ã•ãªã„ æ€è€ƒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯ãƒ†ãƒ³ãƒ—ãƒ¬åˆ†å²ãªã®ã§ä½œã‚Šè¾¼ã¿ãŒé€Ÿã„ ã€Œæœªãƒã‚§ãƒƒã‚¯æ¡ä»¶ã§è½ã¡ãŸã€æ¤œå‡ºãŒå…¥ã‚‹ã“ã¨ã§ æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹å¯è¦–åŒ–ã®ä¾¡å€¤ãŒä¸€æ°—ã«å‡ºã‚‹ 1) ã¾ãšã€Œé›†è¨ˆã—ãŸã„æŒ‡æ¨™ã€ã‚’å›ºå®šï¼ˆMVPæœ€å°ï¼‰ åé›†ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ1å•ã”ã¨ï¼‰ æ­£èª¤ ç ´ã£ãŸæ¡ä»¶æ•°ï¼ˆfailedConditionIds.lengthï¼‰ ç ´ã£ãŸæ¡ä»¶ã« ifThen ãŒå«ã¾ã‚Œã‚‹ã‹ ç ´ã£ãŸæ¡ä»¶ãŒã€Œæœªãƒã‚§ãƒƒã‚¯ã€ã ã£ãŸã‹ï¼ˆcheckedConditionIdsã«å«ã¾ã‚Œãªã„ï¼‰ æ€è€ƒã‚¿ã‚¤ãƒ—ï¼ˆä»Šå›ã¯ condition å›ºå®šã§ã‚‚OKï¼‰ 2) å‹å®šç¾©ï¼ˆResultPageã§ãã®ã¾ã¾ä½¿ãˆã‚‹ï¼‰ src/domain/stats/sessionStats.ts import type { Condition } from "../validator/conditionValidator"; import type { ValidationResult } from "../validator/conditionValidator"; import type { ThinkingDraft } from "../../pages/PlayPage"; // â†‘æœ¬æ¥ã¯ domain/types.ts ã«å¯„ã›ã‚‹ã®ãŒç†æƒ³ã€‚MVPã¯ä¸€æ—¦ã“ã‚Œã§ã‚‚OKã€‚ export type QuestionType = "condition" | "elimination" | "ordering" | "hypothesis"; export type QuestionAttempt = { problemId: string; type: QuestionType; conditions: Condition[]; // ifThenåˆ¤å®šã«ä½¿ã† draftAtSubmit: ThinkingDraft; result: ValidationResult; elapsedSec?: number; usedHint?: boolean; }; export type MistakeTag = | "missed_condition" // ç ´ã£ãŸæ¡ä»¶ãŒæœªãƒã‚§ãƒƒã‚¯ï¼ˆè¦‹è½ã¨ã—ï¼‰ | "ifthen_handling" // ifThenã‚’ç ´ã£ãŸ | "multi_violation" // è¤‡æ•°æ¡ä»¶é•å | "single_violation"; // å˜ç™ºæ¡ä»¶é•åï¼ˆèª­ã¿é•ã„/å½“ã¦ã¯ã‚ä¸è¶³ï¼‰ export type SessionStats = { total: number; correct: number; accuracy: number; // 0..1 avgTimeSec?: number; // æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ç³» avgCheckedRate: number; // å¹³å‡ã€Œãƒã‚§ãƒƒã‚¯æ•°/æ¡ä»¶æ•°ã€ missedConditionCount: number; // æœªãƒã‚§ãƒƒã‚¯ã§è½ã¡ãŸå›æ•° // ãƒŸã‚¹å‚¾å‘ã‚¿ã‚°é›†è¨ˆ mistakeTagCounts: Record<MistakeTag, number>; // æ€è€ƒã‚¿ã‚¤ãƒ—åˆ¥ï¼ˆMVPã¯ condition ã ã‘ã§ã‚‚OKï¼‰ byType: Record<QuestionType, { total: number; correct: number; accuracy: number }>; // ãƒªã‚¶ãƒ«ãƒˆæ–‡ç”Ÿæˆã®ãŸã‚ã®ã€Œå¼·ã„å‚¾å‘ã€ insights: { topWeaknessTags: MistakeTag[]; // ä¸Šä½1ã€œ2 messageLines: string[]; // ãƒªã‚¶ãƒ«ãƒˆã«ãã®ã¾ã¾è¡¨ç¤ºã§ãã‚‹çŸ­æ–‡ }; }; 3) é›†è¨ˆé–¢æ•°ï¼ˆ10å•åˆ†ã‚’é£Ÿã‚ã›ã‚‹ã ã‘ã§StatsãŒå‡ºã‚‹ï¼‰ function isIfThen(cond: Condition): boolean { return cond.type === "ifThen"; } function clamp01(x: number): number { return Math.max(0, Math.min(1, x)); } export function computeSessionStats(attempts: QuestionAttempt[]): SessionStats { const total = attempts.length; const correct = attempts.filter((a) => a.result.isCorrect).length; const accuracy = total === 0 ? 0 : correct / total; // æ™‚é–“ const times = attempts.map((a) => a.elapsedSec).filter((x): x is number => typeof x === "number"); const avgTimeSec = times.length ? Math.round(times.reduce((s, v) => s + v, 0) / times.length) : undefined; // å¹³å‡ãƒã‚§ãƒƒã‚¯ç‡ const checkedRates = attempts.map((a) => { const condTotal = a.conditions.length || 1; const checked = a.draftAtSubmit.checkedConditionIds.length; return checked / condTotal; }); const avgCheckedRate = total === 0 ? 0 : clamp01(checkedRates.reduce((s, v) => s + v, 0) / total); const mistakeTagCounts: Record<MistakeTag, number> = { missed_condition: 0, ifthen_handling: 0, multi_violation: 0, single_violation: 0, }; let missedConditionCount = 0; const byType: SessionStats["byType"] = { condition: { total: 0, correct: 0, accuracy: 0 }, elimination: { total: 0, correct: 0, accuracy: 0 }, ordering: { total: 0, correct: 0, accuracy: 0 }, hypothesis: { total: 0, correct: 0, accuracy: 0 }, }; for (const a of attempts) { // typeé›†è¨ˆ byType[a.type].total += 1; if (a.result.isCorrect) byType[a.type].correct += 1; // æ­£è§£ãªã‚‰ãƒŸã‚¹ã‚¿ã‚°ã¯ä»˜ã‘ãªã„ï¼ˆMVPã§ã¯ï¼‰ if (a.result.isCorrect) continue; const failedIds = a.result.failedConditionIds; const failedCount = failedIds.length; const checkedSet = new Set(a.draftAtSubmit.checkedConditionIds); // ç ´ã£ãŸæ¡ä»¶ã®ã†ã¡ã€æœªãƒã‚§ãƒƒã‚¯ãŒå«ã¾ã‚Œã‚‹ã‹ const missedFailed = failedIds.some((id) => !checkedSet.has(id)); if (missedFailed) { mistakeTagCounts.missed_condition += 1; missedConditionCount += 1; } // ifThenã‚’ç ´ã£ãŸã‹ï¼ˆfailedConditionIdsã«è©²å½“ãŒã‚ã‚‹ã‹ï¼‰ const failedConds = failedIds .map((id) => a.conditions.find((c) => c.id === id)) .filter((c): c is Condition => Boolean(c)); const hasIfThenFail = failedConds.some(isIfThen); if (hasIfThenFail) mistakeTagCounts.ifthen_handling += 1; // è¤‡æ•°é•å/å˜ç™ºé•å if (failedCount >= 2) mistakeTagCounts.multi_violation += 1; else mistakeTagCounts.single_violation += 1; } // typeåˆ¥ accuracy ã‚’è¨ˆç®— (Object.keys(byType) as QuestionType[]).forEach((t) => { const bucket = byType[t]; bucket.accuracy = bucket.total === 0 ? 0 : bucket.correct / bucket.total; }); // --- ã‚¤ãƒ³ã‚µã‚¤ãƒˆç”Ÿæˆï¼ˆMVPï¼šä¸Šä½1ã€œ2ã‚¿ã‚° + å®šå‹æ–‡ï¼‰ --- const sortedTags = (Object.keys(mistakeTagCounts) as MistakeTag[]) .sort((a, b) => mistakeTagCounts[b] - mistakeTagCounts[a]) .filter((t) => mistakeTagCounts[t] > 0); const topWeaknessTags = sortedTags.slice(0, 2); const messageLines: string[] = []; messageLines.push(æ­£è§£ç‡ï¼š${Math.round(accuracy * 100)}%ï¼ˆ${correct}/${total}ï¼‰); messageLines.push(æ¡ä»¶ãƒã‚§ãƒƒã‚¯ç‡ï¼ˆå¹³å‡ï¼‰ï¼š${Math.round(avgCheckedRate * 100)}%); // ã‚¿ã‚°åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç¢ºå®Ÿã«è¨€ãˆã‚‹ç¯„å›²ã§ï¼‰ for (const tag of topWeaknessTags) { if (tag === "missed_condition") { messageLines.push("å‚¾å‘ï¼šæœªãƒã‚§ãƒƒã‚¯ã®æ¡ä»¶ãŒæ®‹ã£ãŸã¾ã¾çµè«–ã«åˆ°é”ã—ã‚„ã™ã„ã§ã™ã€‚"); } else if (tag === "ifthen_handling") { messageLines.push("å‚¾å‘ï¼šã€Œã‚‚ã—ã€œãªã‚‰ã€æ¡ä»¶ã®æ‰±ã„ã§å´©ã‚Œã‚„ã™ã„ã§ã™ã€‚"); } else if (tag === "multi_violation") { messageLines.push("å‚¾å‘ï¼šè¤‡æ•°æ¡ä»¶ã®åŒæ™‚å‡¦ç†ã§ç ´ç¶»ã—ã‚„ã™ã„ã§ã™ã€‚"); } else if (tag === "single_violation") { messageLines.push("å‚¾å‘ï¼šå˜ç™ºã®æ¡ä»¶ã®å½“ã¦ã¯ã‚ã§å–ã‚Šã“ã¼ã—ãŒå‡ºã¦ã„ã¾ã™ã€‚"); } } return { total, correct, accuracy, avgTimeSec, avgCheckedRate, missedConditionCount, mistakeTagCounts, byType, insights: { topWeaknessTags, messageLines, }, }; } 4) ResultPage ã§ã®è¡¨ç¤ºä¾‹ï¼ˆä½¿ã„æ–¹ï¼‰ attemptsï¼ˆ10å•åˆ†ï¼‰ã‚’æ¸¡ã™ã ã‘ã§ã™ã€‚ import { computeSessionStats } from "../domain/stats/sessionStats"; const stats = computeSessionStats(attempts); // stats.insights.messageLines ã‚’ãã®ã¾ã¾ç®‡æ¡æ›¸ãè¡¨ç¤º 5) 10å•ã® attempts ã‚’ã©ã†ä½œã‚‹ã‹ï¼ˆå®Ÿè£…ã®è¦ç‚¹ï¼‰ å„å•é¡Œã§ åˆ¤å®šã™ã‚‹ ã‚’æŠ¼ã—ãŸç¬é–“ã«ã€ä»¥ä¸‹ã‚’1ä»¶ä¿å­˜ã—ã¦é…åˆ—ã«pushï¼š problemId type: "condition" conditions: problem.conditions draftAtSubmit result elapsedSecï¼ˆã‚ã‚Œã°ï¼‰ ã“ã‚Œã‚’ sessionStore.attempts[] ã«æºœã‚ã€10å•å®Œäº†æ™‚ã« ResultPage ã¸ã€‚ 6) MVPã§ã‚‚â€œè¨ºæ–­ã£ã½ãè¦‹ãˆã‚‹â€ãƒªã‚¶ãƒ«ãƒˆæ–‡ãƒ†ãƒ³ãƒ—ãƒ¬ stats.insights.messageLines ã¯ã™ã§ã« æ­£è§£ç‡ å¹³å‡ãƒã‚§ãƒƒã‚¯ç‡ å¼±ç‚¹å‚¾å‘ï¼ˆä¸Šä½1ã€œ2ï¼‰ ãŒå…¥ã‚‹ã®ã§ã€ãã‚Œã ã‘ã§ååˆ†ã€Œä¾¡å€¤ã€ãŒå‡ºã¾ã™ã€‚ 1) sessionStoreï¼ˆattemptsã‚’æºœã‚ã‚‹ï¼‰ src/store/sessionStore.ts import { create } from "zustand"; // ---- typesï¼ˆMVPã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ç½®ã„ã¦OKã€‚å¾Œã§ domain/types.ts ã«åˆ†é›¢æ¨å¥¨ï¼‰ ---- export type Difficulty = 1 | 2 | 3; export type QuestionType = "condition" | "elimination" | "ordering" | "hypothesis"; export type Condition = | { id: string; type: "equals"; entity: string; attribute: string; label?: string } | { id: string; type: "notEquals"; entity: string; attribute: string; label?: string } | { id: string; type: "ifThen"; if: Condition; then: Condition; label?: string }; export type Choice = { id: string; mapping: Record<string, string> }; export type ConditionProblem = { id: string; type: "condition"; difficulty: Difficulty; entities: string[]; attributes: string[]; conditions: Condition[]; question: string; choices: Choice[]; correctChoiceId: string; }; export type ThinkingDraft = { checkedConditionIds: string[]; memo: string; hypotheses: string[]; }; export type ValidationResult = { isCorrect: boolean; selectedChoiceId: string; failedConditionIds: string[]; reasonCode?: "condition_miss" | "condition_misread" | "logic_jump"; }; export type QuestionAttempt = { problemId: string; type: QuestionType; conditions: Condition[]; draftAtSubmit: ThinkingDraft; result: ValidationResult; elapsedSec?: number; usedHint?: boolean; }; export type SessionStatus = "idle" | "playing" | "finished"; // ---- store state ---- type SessionState = { status: SessionStatus; total: number; currentIndex: number; // ç¾åœ¨ã®å•é¡Œï¼ˆMVPã¯ condition problem ã ã‘ã§OKï¼‰ problems: ConditionProblem[]; // ç¾åœ¨ã®å…¥åŠ› selectedChoiceId: string | null; thinkingDraft: ThinkingDraft; // åˆ¤å®šçµæœï¼ˆReviewModalç”¨ï¼‰ isReviewOpen: boolean; validationResult: ValidationResult | null; draftAtSubmit: ThinkingDraft | null; // çµæœï¼ˆ10å•åˆ†ï¼‰ attempts: QuestionAttempt[]; // actions startSession: (args: { total?: number; problems: ConditionProblem[] }) => void; selectChoice: (choiceId: string) => void; updateDraft: (next: ThinkingDraft) => void; openReview: (args: { result: ValidationResult; draftAtSubmit: ThinkingDraft }) => void; closeReview: () => void; commitAttemptAndNext: (args: { elapsedSec?: number; usedHint?: boolean }) => { finished: boolean }; resetSession: () => void; }; const emptyDraft = (): ThinkingDraft => ({ checkedConditionIds: [], memo: "", hypotheses: [] }); export const useSessionStore = create<SessionState>((set, get) => ({ status: "idle", total: 10, currentIndex: 0, problems: [], selectedChoiceId: null, thinkingDraft: emptyDraft(), isReviewOpen: false, validationResult: null, draftAtSubmit: null, attempts: [], startSession: ({ total = 10, problems }) => { set({ status: "playing", total, currentIndex: 0, problems, selectedChoiceId: null, thinkingDraft: emptyDraft(), isReviewOpen: false, validationResult: null, draftAtSubmit: null, attempts: [], }); }, selectChoice: (choiceId) => set({ selectedChoiceId: choiceId }), updateDraft: (next) => set({ thinkingDraft: next }), openReview: ({ result, draftAtSubmit }) => set({ isReviewOpen: true, validationResult: result, draftAtSubmit }), closeReview: () => set({ isReviewOpen: false }), commitAttemptAndNext: ({ elapsedSec, usedHint }) => { const s = get(); const problem = s.problems[s.currentIndex]; const result = s.validationResult; const draftAtSubmit = s.draftAtSubmit; if (!problem || !result || !draftAtSubmit) return { finished: false }; const attempt: QuestionAttempt = { problemId: problem.id, type: problem.type, conditions: problem.conditions, draftAtSubmit, result, elapsedSec, usedHint, }; const nextAttempts = [...s.attempts, attempt]; const nextIndex = s.currentIndex + 1; const finished = nextIndex >= s.total; set({ attempts: nextAttempts, currentIndex: finished ? s.currentIndex : nextIndex, status: finished ? "finished" : "playing", // æ¬¡ã®å•é¡Œã«å‚™ãˆã¦å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ selectedChoiceId: null, thinkingDraft: emptyDraft(), // reviewã‚’é–‰ã˜ã‚‹ isReviewOpen: false, validationResult: null, draftAtSubmit: null, }); return { finished }; }, resetSession: () => set({ status: "idle", total: 10, currentIndex: 0, problems: [], selectedChoiceId: null, thinkingDraft: emptyDraft(), isReviewOpen: false, validationResult: null, draftAtSubmit: null, attempts: [], }), })); 2) PlayPageï¼ˆstoreã‚’ä½¿ã†ç‰ˆï¼šå·®ã—æ›¿ãˆãƒã‚¤ãƒ³ãƒˆï¼‰ src/pages/PlayPage.tsx ã®è¦ç‚¹ã ã‘ç¤ºã—ã¾ã™ï¼ˆUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å‰ã®ã¾ã¾ä½¿ãˆã¾ã™ï¼‰ã€‚ problem ã¯ problems[currentIndex] selectedChoiceId / thinkingDraft ã‚‚ store submitã§ openReview() æ¬¡ã¸ã§ commitAttemptAndNext() â†’ finishedãªã‚‰ /result import React, { useMemo } from "react"; import { useNavigate } from "react-router-dom"; import { useSessionStore } from "../store/sessionStore"; import { validateConditionProblem } from "../domain/validator/conditionValidator"; // å‰ã«ä½œã£ãŸvalidator export default function PlayPage() { const navigate = useNavigate(); const { status, total, currentIndex, problems, selectedChoiceId, thinkingDraft, isReviewOpen, validationResult, draftAtSubmit, selectChoice, updateDraft, openReview, closeReview, commitAttemptAndNext, } = useSessionStore(); const problem = problems[currentIndex]; // ã‚»ãƒƒã‚·ãƒ§ãƒ³æœªé–‹å§‹ã§ /play ã«æ¥ãŸã¨ãã®ã‚¬ãƒ¼ãƒ‰ if (status === "idle" || !problem) { navigate("/"); return null; } const onAbort = () => { const ok = window.confirm("é€²è¡Œä¸­ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’ä¸­æ–­ã—ã¾ã™ã‹ï¼Ÿ"); if (ok) navigate("/"); }; const onSubmit = () => { if (!selectedChoiceId) return; const fixedDraft = { ...thinkingDraft }; const result = validateConditionProblem(problem, selectedChoiceId); openReview({ result, draftAtSubmit: fixedDraft }); }; const onNext = () => { const { finished } = commitAttemptAndNext({}); if (finished) navigate("/result"); }; return ( <div className="min-h-dvh flex flex-col"> {/* Header / Body / SubmitBar ã¯å‰ã®UIã‚’ãã®ã¾ã¾ */} {/* ... */} {/* ReviewModal */} {/* ReviewModal ã® onClose ã¯ closeReviewã€onNext ã¯ onNext */} </div> ); } â€»ã“ã“ã§ã¯ UI ã‚’çœç•¥ã—ã¾ã—ãŸãŒã€å‰ã«ä½œã£ãŸ QuestionHeader / ChoicesList / ThinkingBoard / ReviewModal ã‚’ãã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚ 3) HomePageï¼ˆstartSessionã—ã¦ /play ã¸ï¼‰ src/pages/HomePage.tsxï¼ˆé››å½¢ï¼‰ import React from "react"; import { useNavigate } from "react-router-dom"; import { useSessionStore, ConditionProblem } from "../store/sessionStore"; // MVPï¼šã¨ã‚Šã‚ãˆãšåŒã˜å•é¡Œã‚’10å›ã§ã‚‚OKï¼ˆã‚ã¨ã§ generator ã«ç½®æ›ï¼‰ const sampleProblem: ConditionProblem = { id: "p1", type: "condition", difficulty: 2, entities: ["A", "B", "C"], attributes: ["èµ¤", "é’", "ç·‘"], question: "Aãƒ»Bãƒ»C ã®3äººãŒã€ãã‚Œãã‚Œ èµ¤ãƒ»é’ãƒ»ç·‘ ã®ã„ãšã‚Œã‹ã®å¸½å­ã‚’ã‹ã¶ã£ã¦ã„ã¾ã™ã€‚æ¬¡ã®æ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™çµ„ã¿åˆã‚ã›ã¯ã©ã‚Œã§ã—ã‚‡ã†ï¼Ÿ", conditions: [ { id: "c1", type: "notEquals", entity: "A", attribute: "èµ¤", label: "Aã¯èµ¤ã§ã¯ãªã„" }, { id: "c2", type: "notEquals", entity: "B", attribute: "é’", label: "é’ã‚’ã‹ã¶ã£ã¦ã„ã‚‹äººã¯Bã§ã¯ãªã„" }, { id: "c3", type: "ifThen", if: { id: "c3_if", type: "equals", entity: "C", attribute: "ç·‘" }, then: { id: "c3_then", type: "equals", entity: "A", attribute: "é’" }, label: "ã‚‚ã—CãŒç·‘ãªã‚‰ã€Aã¯é’ã§ã‚ã‚‹", }, ], choices: [ { id: "A", mapping: { A: "é’", B: "èµ¤", C: "ç·‘" } }, { id: "B", mapping: { A: "ç·‘", B: "èµ¤", C: "é’" } }, { id: "C", mapping: { A: "é’", B: "ç·‘", C: "èµ¤" } }, { id: "D", mapping: { A: "èµ¤", B: "é’", C: "ç·‘" } }, ], correctChoiceId: "A", }; export default function HomePage() { const navigate = useNavigate(); const startSession = useSessionStore((s) => s.startSession); const onStart = () => { const problems = Array.from({ length: 10 }, (_, i) => ({ ...sampleProblem, id: p${i + 1}, })); startSession({ total: 10, problems }); navigate("/play"); }; return ( <div className="p-4 max-w-xl mx-auto grid gap-4"> <h1 className="text-xl font-semibold">è€ƒãˆæ–¹ã‚’é›ãˆã‚‹ãƒ­ã‚¸ãƒƒã‚¯ç·´ç¿’</h1> <button className="py-3 rounded-2xl border font-semibold" onClick={onStart}> 10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹ </button> </div> ); } 4) ResultPageï¼ˆattemptsã‚’é›†è¨ˆã—ã¦è¡¨ç¤ºï¼‰ src/pages/ResultPage.tsx import React from "react"; import { useNavigate } from "react-router-dom"; import { useSessionStore } from "../store/sessionStore"; import { computeSessionStats } from "../domain/stats/sessionStats"; export default function ResultPage() { const navigate = useNavigate(); const { attempts, status, resetSession } = useSessionStore(); if (status !== "finished") { navigate("/"); return null; } const stats = computeSessionStats(attempts); return ( <div className="p-4 max-w-xl mx-auto grid gap-3"> <h1 className="text-xl font-semibold">çµæœ</h1> <div className="p-3 rounded-2xl border"> <div className="font-semibold mb-2">è¨ºæ–­ã‚µãƒãƒªãƒ¼</div> <div className="text-sm grid gap-1"> {stats.insights.messageLines.map((t, i) => ( <div key={i}>{t}</div> ))} </div> </div> <div className="p-3 rounded-2xl border"> <div className="font-semibold mb-2">ãƒŸã‚¹å‚¾å‘ï¼ˆå›æ•°ï¼‰</div> <div className="text-sm grid gap-1"> <div>æœªãƒã‚§ãƒƒã‚¯æ¡ä»¶ã§è½ã¡ãŸï¼š{stats.mistakeTagCounts.missed_condition}</div> <div>ifThenã§è½ã¡ãŸï¼š{stats.mistakeTagCounts.ifthen_handling}</div> <div>è¤‡æ•°æ¡ä»¶é•åï¼š{stats.mistakeTagCounts.multi_violation}</div> <div>å˜ç™ºæ¡ä»¶é•åï¼š{stats.mistakeTagCounts.single_violation}</div> </div> </div> <div className="grid gap-2"> <button className="py-3 rounded-2xl border font-semibold" onClick={() => { resetSession(); navigate("/"); }} > ã‚‚ã†ä¸€å› </button> </div> </div> ); } 5) ãƒ«ãƒ¼ã‚¿ãƒ¼ä¾‹ï¼ˆæœ€ä½é™ï¼‰ src/app/router.tsx import React from "react"; import { createBrowserRouter } from "react-router-dom"; import HomePage from "../pages/HomePage"; import PlayPage from "../pages/PlayPage"; import ResultPage from "../pages/ResultPage"; export const router = createBrowserRouter([ { path: "/", element: <HomePage /> }, { path: "/play", element: <PlayPage /> }, { path: "/result", element: <ResultPage /> }, ]); ã“ã“ã¾ã§ã§å®Œæˆã™ã‚‹æµã‚Œ Home â†’ startSession â†’ Play Play â†’ åˆ¤å®š â†’ ReviewModal æ¬¡ã¸ â†’ attemptsã«è¨˜éŒ² â†’ æ¬¡å•é¡Œã¸ 10å•çµ‚ã‚ã‚Š â†’ Result Result â†’ ã‚‚ã†ä¸€å›